---

version: 0.2

phases:
  pre_build:
    commands:
      - echo "Elevating CI user credentials"
      - |
        aws iam attach-group-policy \
          --group-name "CIAccess" \
          --policy-arn "arn:aws:iam::aws:policy/AdministratorAccess"
  build:
    commands:
      - set -e
      - |
        echo "Waiting 30 seconds for IAM permissions to apply"
        sleep 30
        cd terraform/shared_account_pathtolive_infra_ci_monitoring
        TF_VAR_is_cd=true terraform init
        TF_VAR_is_cd=true terraform apply -auto-approve
  post_build:
    commands:
      - echo "Removing CI user credentials elevation"
      - |
        aws iam detach-group-policy \
          --group-name "CIAccess" \
          --policy-arn "arn:aws:iam::aws:policy/AdministratorAccess"
...
